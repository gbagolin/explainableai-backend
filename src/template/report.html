<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Report</title>
    <meta name="description" content="Report example">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
</head>
<style>
    html{
        font-family: 'Quicksand', sans-serif;
    }
    .text-center{
        text-align:center;
    }
    .text-yellow{
        color: rgba(251, 191, 36, 1);
    }
    .anomalies {
      font-family: Arial, Helvetica, sans-serif;
      border-collapse: collapse;
      width: 100%;
    }

    .anomalies td, .anomalies th {
      border: 1px solid #ddd;
    }

    .anomalies tr:nth-child(even){background-color: #f2f2f2;}

    .anomalies tr:hover {background-color: #ddd;}

    .anomalies th {
      text-align: left;
      background-color: rgba(251, 191, 36, 1);
      color: white;
    }

    .m-5{
        margin: 5rem;
    }

    .font-sm{
        font-size: 0.7rem;
    }

    .font-lg{
        font-size: 1.5rem;
    }

    .plot{
        width: 60%;
        height: 60%;
    }


</style>
<body>
<article>
    <h1 class="text-center text-yellow">Explainable POMCP report generated at:</h1>
    <h1 class="text-center text-yellow">{{context.now}}</h1>
    <div class="m-5"></div>
    {% for action in context.actions %}
    <h4 class="font-lg">Rule: {{loop.index}}</h4>
    <p class="font-lg">Rule action: {{action.name}}</p>
    <p class="font-lg">Rule template:</p>
    <ol>
        {% for sub_rule in context.rule_string[loop.index - 1] %}
        <li>{{sub_rule[1]}}</li>
        {% endfor %}
    </ol>
    <p class="font-lg">Rule synthetized:</p>
    <ol>
        {% for sub_rule in context.rules_synthetized[loop.index - 1] %}
        <li>{{sub_rule}}</li>
        {% endfor %}
    </ol>
    {% if context.anomalies_same_action[loop.index - 1].anomalies | length > 0 %}
    <p>Figure 1 represents the distribution of Hellinger Distance among anomalies</p>
    <img src="data:image/jpeg;base64,{{ context.distribution_plot[loop.index - 1] }}"
         class="plot"/>
    {% endif %}

    {% if context.anomalies_same_action[loop.index - 1].anomalies | length > 0 %}
    <p>In table 1, all the anomalies whose action choosen by the agent is equal to the one analyzed in the rule are
        shown.</p>
    <table class="anomalies">
        <tr>
            <th>#</th>
            <th>Run</th>
            <th>Step</th>
            <th>Action</th>
            <th>Beliefs</th>
            <th>Severity</th>
        </tr>
        {%for anomaly in context.anomalies_same_action[loop.index - 1].anomalies %}
        <tr>
            <td>{{loop.index}}</td>
            <td>{{anomaly['run']}}</td>
            <td>{{anomaly['step']}}</td>
            <td>{{anomaly['action']}}</td>
            <td>
                {%for bel in anomaly['beliefs']%}
                {{bel['state']}}: {{bel['belief']| round(2)}}<br>
                {% endfor %}
            </td>
            <td>{{anomaly['hellinger_distance'] | round(2)}}</td>
        </tr>
        {% endfor %}
    </table>
    <p class="text-center font-sm">Table 1. </p>
    {% endif %}
    {% if context.anomalies_different_action[loop.index - 1].anomalies | length > 0 %}
    <p>In table 2, all the anomalies whose action choosen by the agent is different to the one analyzed in the rule are
        shown.</p>
    <table class="anomalies">
        <tr>
            <th>#</th>
            <th>Run</th>
            <th>Step</th>
            <th>Action</th>
            <th>Beliefs</th>
        </tr>
        {%for anomaly in context.anomalies_different_action[loop.index - 1].anomalies %}
        <tr>
            <td>{{loop.index}}</td>
            <td>{{anomaly['run']}}</td>
            <td>{{anomaly['step']}}</td>
            <td>{{anomaly['action']}}</td>
            <td>
                {%for bel in anomaly['beliefs']%}
                {{bel['state']}}: {{bel['belief']| round(2)}}<br>
                {% endfor %}
            </td>
        </tr>
        {% endfor %}
    </table>
    <p class="text-center font-sm">Table 2. </p>
    {% endif %}
    {% endfor %}
</article>
</body>
</html>